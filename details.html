<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Detalle del Caso</title>
<style>
body{font-family:sans-serif;background:#f1f1f1;padding:10px}
.card{background:#fff;padding:15px;border-radius:10px}
.btn{padding:10px;width:100%;margin:5px 0}
.verde{background:#28a745;color:white}
.naranja{background:#fd7e14;color:white}
.rojo{background:#dc3545;color:white}
</style>
</head>
<body>

<div id="detalle" class="card"></div>

<script>
const id=new URLSearchParams(location.search).get('id');

async function cargar(){
  const r=await fetch('/.netlify/functions/infieles?id='+id);
  const i=await r.json();
  const total=i.aprobados+i.refutados+i.denunciados||1;

  detalle.innerHTML=`
  <h2>${i.nombre} ${i.apellido}</h2>
  <p><b>Ubicaci√≥n:</b> ${i.ubicacion}</p>
  <p>${i.historia}</p>

  <button class="btn verde" onclick="votar('aprobar')">Aprobar</button>
  <button class="btn naranja" onclick="votar('refutar')">Refutar</button>
  <button class="btn rojo" onclick="votar('denunciar')">Denunciar</button>

  <h3>Comentarios</h3>
  ${(i.comentarios||[]).map(c=>`<p><b>${c.nick}:</b> ${c.texto}</p>`).join('')}
  <input id="nick" placeholder="Tu nick">
  <textarea id="texto"></textarea>
  <button onclick="comentar()">Comentar</button>
  `
}

async function votar(v){
  await fetch('/.netlify/functions/infieles',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({tipo:'voto',id,voto:v})
  });
  location.reload();
}

async function comentar(){
  await fetch('/.netlify/functions/infieles',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      tipo:'comentario',
      id,
      comentario:{nick:nick.value||'Anonimo',texto:texto.value}
    })
  });
  location.reload();
}

cargar();
</script>
</body>
</html>
