<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Registro de Infieles</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:sans-serif;background:#f1f1f1;padding:10px}
.card{background:#fff;border-radius:10px;margin:10px;padding:15px}
.btn{padding:10px;width:100%;margin:5px 0}
</style>
</head>
<body>

<h2>Registro Nacional de Infieles</h2>
<button onclick="document.getElementById('form').style.display='block'">➕ Exponer Infiel</button>

<div id="lista"></div>

<div id="form" style="display:none">
<input id="reportero" placeholder="Tu nick">
<input id="nombre" placeholder="Nombre">
<input id="apellido" placeholder="Apellido">
<input id="edad" type="number" placeholder="Edad">
<input id="ubicacion" placeholder="Ubicación">
<textarea id="historia" placeholder="Historia"></textarea>
<input type="file" id="pruebas" multiple>
<button onclick="publicar()">Publicar</button>
</div>

<script>
async function publicar(){
  const imgs=[];
  for(let f of pruebas.files){
    const r=new FileReader();
    await new Promise(res=>{
      r.onload=()=>{imgs.push(r.result);res();}
      r.readAsDataURL(f);
    })
  }

  await fetch('/.netlify/functions/infieles',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      tipo:'nuevo',
      reportero:reportero.value||'Anonimo',
      nombre:nombre.value,
      apellido:apellido.value,
      edad:edad.value,
      ubicacion:ubicacion.value,
      historia:historia.value,
      imagenes:imgs
    })
  });
  location.reload();
}

async function cargar(){
  const r=await fetch('/.netlify/functions/infieles');
  const d=await r.json();
  lista.innerHTML='';
  d.forEach(i=>{
    lista.innerHTML+=`
    <div class='card'>
      <b>${i.nombre} ${i.apellido}</b><br>
      ${i.ubicacion}<br>
      <button class='btn' onclick="location.href='details.html?id=${i.id}'">Ver todo el chisme</button>
    </div>`;
  })
}
cargar();
</script>
</body>
</html>
