
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Nacional de Infieles</title>
    <style>
        :root {
            --azul: #007bff;
            --azul-oscuro: #0056b3;
            --fondo: #f8f9fa;
            --blanco: #ffffff;
            --gris: #6c757d;
            --texto: #212529;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: var(--fondo);
            color: var(--texto);
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto;
            padding: 0;
        }

        /* Mensaje para PC */
        #solo-movil {
            display: none;
            text-align: center;
            padding: 50px 20px;
            background: #fff;
            min-height: 100vh;
            font-size: 1.2em;
        }

        @media (min-width: 768px) {
            body > *:not(#solo-movil) { display: none !important; }
            #solo-movil { display: block !important; }
        }

        header {
            text-align: center;
            padding: 30px 15px;
            background-color: var(--blanco);
            border-bottom: 4px solid var(--azul);
            box-shadow: 0 2px 10px rgba(0,123,255,0.15);
        }
        h1 {
            font-size: 2em;
            color: var(--azul);
            margin-bottom: 8px;
        }
        header p { font-size: 1em; color: var(--gris); }

        .btn-principal, .btn-legal {
            padding: 14px 20px;
            font-size: 1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 8px;
            width: 90%;
            max-width: 400px;
        }
        .btn-principal {
            background-color: var(--azul);
            color: white;
        }
        .btn-principal:hover { background-color: var(--azul-oscuro); }
        .btn-legal {
            background-color: #dc3545;
            color: white;
        }

        #search-section {
            padding: 20px 15px;
            background-color: var(--blanco);
            text-align: center;
        }
        #search-input {
            width: 95%;
            padding: 14px;
            border: 2px solid #ced4da;
            border-radius: 30px;
            font-size: 1.1em;
            text-align: center;
        }
        #search-input:focus { border-color: var(--azul); outline: none; }

        #lista-infieles {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .card {
            background: var(--blanco);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        .card-header {
            background-color: var(--azul);
            color: white;
            padding: 16px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        .card-body { padding: 16px; }
        .info {
            margin: 10px 0;
            font-size: 0.98em;
            color: var(--gris);
        }
        .info strong { color: var(--texto); }
        .anonym { font-style: italic; color: #888; }

        .btn-ver { 
            width: 100%; 
            padding: 14px; 
            background: var(--azul); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 1.1em; 
            margin-top: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 25px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        .close {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
        }

        label { display: block; margin: 15px 0 5px; font-weight: bold; }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        .galeria img {
            width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .votos { display: flex; justify-content: space-around; margin: 20px 0; }
        .voto-btn { padding: 10px 15px; border-radius: 8px; color: white; border: none; font-weight: bold; }
    </style>
</head>
<body>

    <!-- Solo para PC -->
    <div id="solo-movil">
        <h2>Este sitio solo funciona en celulares</h2>
        <p>Abre esta página desde tu teléfono para usarlo correctamente.</p>
    </div>

    <!-- Modal Edad -->
    <div id="age-modal" class="modal active">
        <div class="modal-content">
            <h2>Confirmación de Edad</h2>
            <p>Este contenido es para mayores de 18 años.</p>
            <button class="btn-principal" onclick="confirmAge(true)">Sí, tengo 18+</button>
            <button class="btn-legal" onclick="confirmAge(false)">No</button>
        </div>
    </div>

    <!-- Contenido principal (solo visible en móvil) -->
    <div id="main-content" style="display:none;">
        <header>
            <h1>Registro de Infieles</h1>
            <p>Plataforma anónima</p>
            <button class="btn-principal" id="btn-agregar">+ Agregar Infiel</button>
            <button class="btn-legal" id="btn-legal">Información Legal Importante</button>
        </header>

        <section id="search-section">
            <input type="text" id="search-input" placeholder="Buscar nombre o ciudad..." onkeyup="filtrar()">
        </section>

        <div id="lista-infieles"></div>
    </div>

    <!-- Modal Formulario -->
    <div id="modal-form" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal()">&times;</span>
            <h2>Nuevo Registro</h2>
            <form id="form-infiel">
                <label>Tu nick (opcional)</label>
                <input type="text" id="reportero" placeholder="Ej: La Vengadora">
                <label>Nombre del infiel</label>
                <input type="text" id="nombre" required>
                <label>Apellido</label>
                <input type="text" id="apellido" required>
                <label>Edad</label>
                <input type="number" id="edad" min="18" required>
                <label>De dónde es</label>
                <input type="text" id="ubicacion" required>
                <label>Historia completa</label>
                <textarea id="historia" rows="5" required></textarea>
                <label>Pruebas (fotos)</label>
                <input type="file" id="pruebas" accept="image/*" multiple>
                <button type="submit" class="btn-ver">Publicar</button>
            </form>
        </div>
    </div>

    <!-- Modal Detalle -->
    <div id="modal-chisme" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarDetalle()">&times;</span>
            <div id="detalle-chisme"></div>
        </div>
    </div>

    <!-- Modal Legal (AHORA FUNCIONA) -->
    <div id="modal-legal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarLegal()">&times;</span>
            <h2>Información Legal Importante</h2>
            <p><strong>Este es un sitio de entretenimiento y sátira.</strong></p>
            <p>Todas las publicaciones se consideran <strong>ficticias</strong> salvo prueba legal en contrario.</p>
            <p>Queda prohibido:</p>
            <ul>
                <li>Subir datos reales de menores</li>
                <li>Publicar imágenes íntimas sin consentimiento</li>
                <li>Usar este sitio para acoso o extorsión</li>
            </ul>
            <p>Los administradores pueden eliminar cualquier contenido.</p>
            <p><strong>Usas este sitio bajo tu propia responsabilidad.</strong></p>
            <button class="btn-legal" onclick="cerrarLegal()" style="width:100%;margin-top:20px;">Entendido</button>
        </div>
    </div>

    <script>
        // Detectar si es móvil
        if (window.innerWidth >= 768) {
            document.getElementById('main-content').style.display = 'none';
            document.getElementById('age-modal').style.display = 'none';
        }

        function confirmAge(ok) {
            if (ok) {
                document.getElementById('age-modal').classList.remove('active');
                document.getElementById('main-content').style.display = 'block';
                cargarInfieles();
            } else {
                window.location.href = 'https://google.com';
            }
        }

        document.getElementById('btn-agregar').onclick = () => {
            document.getElementById('modal-form').classList.add('active');
        };

        // BOTÓN LEGAL AHORA SÍ FUNCIONA
        document.getElementById('btn-legal').onclick = () => {
            document.getElementById('modal-legal').classList.add('active');
        };

        function cerrarLegal() {
            document.getElementById('modal-legal').classList.remove('active');
        }

        function cerrarModal() {
            document.getElementById('modal-form').classList.remove('active');
            document.getElementById('form-infiel').reset();
        }

        function cerrarDetalle() {
            document.getElementById('modal-chisme').classList.remove('active');
        }

        // Resto del código (igual que antes, 100% funcional)
        document.getElementById('form-infiel').onsubmit = async e => {
            e.preventDefault();
            const files = document.getElementById('pruebas').files;
            const imgs = [];
            for (let f of files) if (f.type.startsWith('image/')) imgs.push(await fileToBase64(f));
            const nuevo = {
                id: Date.now(),
                reportero: document.getElementById('reportero').value.trim() || 'Anónimo',
                nombre: document.getElementById('nombre').value.trim(),
                apellido: document.getElementById('apellido').value.trim(),
                edad: document.getElementById('edad').value,
                ubicacion: document.getElementById('ubicacion').value.trim(),
                historia: document.getElementById('historia').value.trim(),
                imagenes: imgs,
                fecha: new Date().toLocaleDateString('es-ES'),
                votos: {aprobar:0, refutar:0, denunciar:0},
                comentarios: []
            };
            let lista = JSON.parse(localStorage.getItem('infieles') || '[]');
            lista.unshift(nuevo);
            localStorage.setItem('infieles', JSON.stringify(lista));
            cerrarModal(); cargarInfieles();
            alert('Publicado con éxito');
        };

        function fileToBase64(file) {
            return new Promise(r => {
                const fr = new FileReader();
                fr.onload = () => r(fr.result);
                fr.readAsDataURL(file);
            });
        }

        function cargarInfieles() {
            const cont = document.getElementById('lista-infieles');
            const lista = JSON.parse(localStorage.getItem('infieles') || '[]');
            if (!lista.length) {
                cont.innerHTML = '<p style="text-align:center;padding:50px;color:#666;">Aún no hay registros.<br>Sé el primero en publicar</p>';
                return;
            }
            cont.innerHTML = '';
            lista.forEach(i => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">${i.nombre} ${i.apellido}, ${i.edad} años</div>
                    <div class="card-body">
                        <div class="info"><strong>Reportado por:</strong> ${i.reportero}</div>
                        <div class="info"><strong>De:</strong> ${i.ubicacion}</div>
                        <button class="btn-ver" onclick="verChisme(${i.id})">Ver todo el chisme ${i.imagenes.length ? '('+i.imagenes.length+' fotos)' : ''}</button>
                    </div>
                `;
                cont.appendChild(card);
            });
        }

        function verChisme(id) {
            const infiel = JSON.parse(localStorage.getItem('infieles') || '[]').find(x => x.id === id);
            if (!infiel) return;
            const galeria = infiel.imagenes.length ? infiel.imagenes.map(src => `<img src="${src}" class="galeria">`).join('') : '<p>Sin pruebas</p>';
            document.getElementById('detalle-chisme').innerHTML = `
                <h2>${infiel.nombre} ${infiel.apellido}</h2>
                <p><strong>Reportado por:</strong> ${infiel.reportero}</p>
                <p><strong>Ubicación:</strong> ${infiel.ubicacion}</p>
                <hr>
                <p style="background:#f1f3f5;padding:15px;border-radius:8px;">${infiel.historia.replace(/\n/g,'<br>')}</p>
                <h3>Pruebas:</h3>${galeria}
                <div class="votos">
                    <button class="voto-btn" style="background:#28a745;" onclick="votar(${id},'aprobar')">Aprobar (${infiel.votos.aprobar})</button>
                    <button class="voto-btn" style="background:#ffc107;color:black;" onclick="votar(${id},'refutar')">Refutar (${infiel.votos.refutar})</button>
                    <button class="voto-btn" style="background:#dc3545;" onclick="votar(${id},'denunciar')">Denunciar (${infiel.votos.denunciar})</button>
                </div>
            `;
            document.getElementById('modal-chisme').classList.add('active');
        }

        function votar(id, tipo) {
            let lista = JSON.parse(localStorage.getItem('infieles') || '[]');
            const infiel = lista.find(x => x.id === id);
            if (infiel) infiel.votos[tipo]++;
            localStorage.setItem('infieles', JSON.stringify(lista));
            verChisme(id);
        }

        function filtrar() {
            const txt = document.getElementById('search-input').value.toLowerCase();
            document.querySelectorAll('.card').forEach(c => {
                c.style.display = c.textContent.toLowerCase().includes(txt) ? 'flex' : 'none';
            });
        }
    </script>
</body>
</html>
